电子书

平台：s3c2440

描述：通过命令行方式打开电子书。支持自定义显示设备（目前只支持lcd显示），支持选择字库文件，支持ASCII、UTF8、UTF16LE、UTF16BE编码格式，使用freetype库获取图片位图，支持显示字体大小设置，支持标准输入（stdin）、触摸屏输入（tslib库）与按键（Key）方式控制电子书翻页，标准输入同时支持输入指定页码进行跳页。支持标准输出（stdout）与网络打印（socket）调试信息。

1）输入事件读取：对每种输入方式实现一个独立的子线程，在子线程中对输入事件进行阻塞读取（可降低cpu占用），当读取到符合要求的输入事件之后，先获取互斥量，取得符合要求的输入事件，然后唤醒主线程，返回已经得到的输入事件。按键驱动未使用输入子系统，使用的是自己写的一个驱动。

2）指定页码跳页功能：支持跳转到已显示过的页面。通过一个双向链表实现，链表中记录了页码、当前页面内容在文件指针中的地址以及下一页内容的起始地址。已经显示过的页面，都会放入此链表中。

3）打印信息调试：支持标准输出（stdout）与网络打印（socket）调试信息。
网络打印选择使用UDP方式进行数据传输（打印数据的数据准确性要求不高），初始化数据发送子进程和数据接收子进程。在每次打印数据时，会先将数据放入循环缓冲区，之后唤醒发送进程，发送进程会查看是否已经有客户端连接，如果已有客户端连接则发送打印数据。接收数据进程可以在接收打印数据之前，可先行设置打印等级，以及开关打印通道。

UDP的特性是：数据报，无连接，简单，不可靠，会丢包，会乱序（实际中遇到的主要是丢包）。
TCP的特性是：流式，有连接，复杂，可靠，延迟较大、带宽占用较大（均是相对于UDP来说）。

4）字符的显示：首先使用只读方式打开文本文件，使用mmap将文件内容映射到一块内存中，根据文件开头的数据（可参照第5点）得到符合的文件编码处理方式。显示时，先获取一个字符的unicode码，判断是否是回车换行TAB等特殊字符。如果是一个普通的字符，使用freetype库提供的API，从字库文件中找到该字符的位图文件，判断此页面能否再显示字符，如果可以根据位图像素（支持1,8位像素格式）将位图拷贝显存中。

5）判断文件编码格式的方式：文件起始位置上的几个字节数据标识了文件编码格式
utf8    - 0xEF 0xBB 0xBF
utf16le - 0xFF 0xFE
utf16be - 0xFE 0xFF
ACSII   - 如果以上三者都不是的话 则是ASCII编码方式

6）freetype库：使用提供的API获取到的字体位图，起始坐标位置在左下角，而LCD坐标系的起始位置在左上角，写入到显存之前需要进行Y轴坐标系转换。通常为转化坐标系=屏幕分辨率-原始坐标系值。对于单个字体而言，即转化坐标系=字体大小-原始坐标系值。
